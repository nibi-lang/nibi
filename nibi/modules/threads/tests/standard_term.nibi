(use "io" "threads")

(fn busy [] [
  (threads::sleep (threads::time::seconds 5))
  (<- 42)
])

(io::println "Starting...")

(:= tcell (threads::future (busy)))

(io::println "tcell: " tcell ", is_ready: " (threads::future::ready tcell))

(:= count 0)
(while (not (threads::future::ready tcell)) [
  (set count (+ 1 count))
  (io::println "waiting.. " count)
  (threads::future::wait tcell (threads::time::milli 500))
])

(assert (eq count 10))

(io::println "Complete in " (threads::future::runtime tcell) "ms")

(io::println "Got: " (threads::future::get tcell))

(io::println "END")
