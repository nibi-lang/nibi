(use "io" "threads")

(fn busy [] [
  (loop (:= i 0) (< i 1000000) (set i (+ i 1)) (nop))
  (<- 42)
])

(io::println "Starting...")

(:= tcell (threads::future (busy)))

(io::println "tcell: " tcell ", is_ready: " (threads::future::ready tcell))

(while (not (threads::future::ready tcell)) [
  (io::println "waiting..")
  (threads::future::wait tcell 1000000)
])

(io::println "Complete in " (threads::future::runtime tcell) "ms")

(drop tcell)

(io::println "END")
